{% extends "base.html" %}
{% load static %}


{% block logo %}
<div class="logo float-left">
  <h1 class="text-light"><a href="/" class="scrollto font-rajdhani"><span>GEOFLUXO</span></a></h1>
</div>
{% endblock logo %}


{% block nav %}
<nav class="main-nav float-right d-none d-lg-block font-rajdhani">
  <ul>
    <li><a href="#objetivo">Objetivo</a></li>
    <li><a href="#publicacoes">Publicações</a></li>
    <li><a href="#pesquisas">Portifólio</a></li>
    <li><a href="#projetos">Projetos</a></li>
    <li><a href="#team">Membros</a></li>
  </ul>
</nav>
{% endblock nav %}


{% block intro %}
<div class="d-flex pb-lg-5">
  <div>
    <h2 class="d-none d-lg-block text-light mb-5 display-3 font-rajdhani area-name">
    </h2>
    <h1 class="d-lg-none text-center text-light mb-5 font-rajdhani area-name">
    </h1>
  </div>
</div>
{% endblock intro %}

{% block main %}


<section id="objetivo">

  <div class="d-flex flex-column">

    <header class="order-0 section-header pt-5">
      <h3 class="section-title">Objetivo & Setores</h3>
      <p class="pb-3 pb-lg-5 area-name"></p>
    </header>

    <div class="order-2 order-lg-1 container my-lg-0 my-4">
      <h5 id="description" class="font-rajdhani">
        <span class="text-secondary">
          Setores de atividade:
        </span>
        Obras de infra-estrutura.
      </h5>
    </div>

    <div class="order-1 order-lg-2 container my-lg-5 pb-lg-4">
      <div class="col-lg-12 background px-0 order-lg-1 order-1 wow fadeInUp">
        <div id="area-image" class="member">
          <!-- JSON image -->
        </div>
      </div>
    </div>

  </div>

</section>

<section id="publicacoes" style="padding: 60px 0; background: #004a99;">
  <div class="container">
    <div class="mb-lg-5 pb-lg-5">

      <header class="section-header">
        <h3 style="color: white !important;">Publicações</h3>
        <p style="color: white !important;" class="area-name">Leia e faça o download das publicações de </p>
      </header>

      <ul id="publications-ul" class="list-group shadow">
        <!-- JSON publications -->
      </ul>

    </div>
  </div>
</section>

<section id="pesquisas" style="box-shadow: 0px 0px 12px 0px rgba(0, 0, 0, 0.1);">
  <div class="container py-5">
    <header class="section-header">
      <h3 class="section-title">Portifólio</h3>
      <p class="area-name">Portifólio da área de </p>
    </header>
    <div id="portfolio" style="box-shadow:none; padding-top:0em; padding-bottom:0em;" class="clearfix">
      <div id="portfolio-items-div" class="row portfolio-container" style="height: auto !important;">
        <!-- JSON portfolio_items -->
      </div>
    </div>

  </div>
</section>

<section class="section-bg" id="projetos" style="box-shadow: inset 0px 0px 12px 0px rgba(0, 0, 0, 0.1);">
  <div class="container py-5">
    <div class="mb-0">
      <header class="section-header mt-3">
      <h3>Projetos</h3>
      <p class="area-name">Projetos de pesquisa e extensão de </p>
    </header>

      <div id="projects-div" class="d-flex flex-column">
        <!-- JSON projects -->
      </div>
    </div>
  </div>
</section>

<section id="team" >
  <div class="container">
    <div class="mb-5 pb-5" style="box-shadow: none; padding-bottom: 0;">
      <div class="section-header">
      <h3>Membros</h3>
      <p class="area-name">Pessoas que trabalham na área de </p>
    </div>

      <div id="users-div" class="row mb-5">
        <!-- JSON users -->
      </div>

    </div>
  </div>
</section>

{% endblock main %}

{% block js %}


<script type="text/javascript">
  var base_url = "https://grupogeofluxo.pythonanywhere.com";
  var area_id = getUrlParameter('id');

  console.log('area_id',area_id);

  // AREA
  $.ajax({

    url: base_url.concat("/area/").concat(area_id),
    success: function(area){

    var area_description = $("#description");
    area_description.prepend(area.description);

    var area_image = $("#area-image");
    area_image.append(`<img src="${area.image}" class="img-fluid shadow rounded" alt="mining">`);

    var area_names = $(".area-name");
    $(area_names).each(function(area_name){
        $(this).append(area.name)
    });
  }});

  // AREA - PUBLICATIONS
  $.ajax({

    url: base_url.concat("/area-publications/").concat(area_id),
    success: function(area_publications){

      var publications_ul = $("#publications-ul")
      area_publications.forEach(function(publication){

        var publication_element = `<li class="list-group-item p-2"> <div class="d-none d-lg-flex justify-content-between"> <span class="text-secondary font-rajdhani">${publication.publication_date}</span> <span class="ml-3"><b>${publication.title}</b></span> <a href="${publication.url}"> <i class="fa fa-download"></i> </a> </div> <div class="d-flex d-lg-none flex-column"> <div class="d-flex align-items-center justify-content-between"> <span class="text-secondary font-rajdhani">${publication.publication_date}</span> <a href="${publication.url}"> <i class="fa fa-download mx-2"></i> </a> </div> <hr class="w-100 my-0"> <span class="font-rajdhani"><b>${publication.title}</b></span> </div> </li>`;

        publications_ul.append(publication_element);

      });
  }});


  // AREA - PORTFOLIO ITEMS
  $.ajax({

    url: base_url.concat("/area-portfolio-items/").concat(area_id),
    success: function(area_portfolio_items){

      var portfolio_items_div = $("#portfolio-items-div")
      area_portfolio_items.forEach(function(portfolio_item){

        var portfolio_item = `<div class="col-lg-4 col-md-6 portfolio-item filter-area-${(portfolio_item.area||'outros')}"> <div class="portfolio-wrap"> <img src="${portfolio_item.image}" class="img-fluid" alt=""> <div class="portfolio-info"> <h4><a href="${portfolio_item.url}">${portfolio_item.title}</a></h4> <p>${portfolio_item.subtitle}</p> <div> <a href="${portfolio_item.url}" class="link-details" title="More Details"><i class="ion ion-android-open"></i></a> </div> </div> </div> </div>`;

        portfolio_items_div.prepend(portfolio_item);
      });

      $(portfolio_items_div).css("height","auto");

  }});


  // AREA - PROJECTS
  $.ajax({

    url: base_url.concat("/area-projects/").concat(area_id),
    success: function(area_projects){

      var projects_div = $("#projects-div")
      area_projects.forEach(function(project){

        var project_item = `<div class="d-none d-lg-flex bg-white justify-content-between align-items-center rounded shadow p-3 my-3 wow fadeInUp"> <div class="d-flex align-items-center w-75 font-rajdhani"> <h5 class="ml-3 text-secondary my-1">${project.initial_date} </h5> <h5 class="text-secondary mx-2 my-1"> - </h5> <h5 class="text-secondary my-1"> ${project.final_date||'Atual'}</h5> <h5 class="mx-5 ml-3 text-left my-1 font-rajdhani">${project.name}</h5> </div> <div class="client-logo w-25"> <img src="${project.partner.image}" class="img-fluid" alt="${project.partner.name}"> </div> </div> <div class="d-flex flex-column d-lg-none bg-white justify-content-between align-items-center rounded shadow p-3 my-3 wow fadeInUp"> <div class="d-flex align-items-center font-rajdhani"> <img src="${project.partner.image}" style="height:3em;" class="img-fluid" alt="${project.partner.name}"> <h5 class="ml-3 text-secondary my-1">${project.initial_date} </h5> <h5 class="text-secondary mx-2 my-1"> - </h5> <h5 class="text-secondary my-1"> ${project.final_date||'Atual'}</h5> </div> <hr class="my-2 w-100"> <h5 class="text-left my-1 font-rajdhani">${project.name}</h5> </div>`;


        projects_div.prepend(project_item);
      });
  }});


  // AREA - USERS
  var titles_json = {'M':{'CD':'Coordenador', 'DR':'Doutor', 'MS':'Mestre', 'BC':'Bacharel', 'TC':'Técnico', 'GD':'Graduando'}, 'F':{'CD':'Coordenadora', 'DR':'Doutora', 'MS':'Mestra', 'BC':'Bacharel', 'TC':'Técnica', 'GD':'Graduanda'}};

  $.ajax({
    url: base_url.concat("/area-users/").concat(area_id),
    success: function(area_users){

      var users_div = $("#users-div")
      area_users.forEach(function(member){

        var user_item = `<div class="col-lg-3 col-md-6 wow fadeInUp"> <div class="member"> <img src="${member.image}" class="img-fluid" alt=""> <div class="member-info"> <div class="member-info-content"> <h4>${member.first_name}</h4> <span>${titles_json[member.gender][member.title]}</span> <div class="social"> <a href="${member.lattes_url}">Lattes</a> </div> </div> </div> </div> </div>`;

        users_div.prepend(user_item);
      });
  }});

</script>

{% endblock js %}
